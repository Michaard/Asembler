$ NOMOD51
$ INCLUDE (8051_mgraniczka.MCU)

T0_VAL EQU (65535-46080)
TL0_VAL EQU (T0_VAL mod 256)
TH0_VAL EQU (T0_VAL/256)
CSDS EQU 0FF30h

ORG 0000h
_RESET:
	LJMP _INIT

ORG 0Bh
_INT_T0:
	ORL TL0,#TL0_VAL
	MOV TH0,#TH0_VAL
	INC _COUNTER
	RETI

ORG 0100h
_INIT:
	MOV TL0,#TL0_VAL
	MOV TH0,#TH0_VAL
	
	ANL TCON,#11001111b
	ANL TMOD,#11110001b
	ORL TMOD,#00000001b
	ORL IE,#10000010b
	
	MOV _COUNTER,#0d
	MOV _FREQ,#20d
	SETB P3.5
	MOV DPTR,#CSDS
	
	ORL TCON,#00010000b
_LOOP:
	LCALL _READ_INPUT
	MOV A,_COUNTER
	CJNE A,_FREQ,_CD
	MOV _COUNTER,#0d
	CPL _LED
_CD:
	LJMP _LOOP

_READ_INPUT:
	_IF:
		MOV A,#00000001b
		MOVX @DPTR,A
		JNB P3.5,_ELSIF1
		SETB _LED
		MOV _FREQ,#10d
		LJMP _FINALLY
	_ELSIF1:
		MOV A,#00000010b
		MOVX @DPTR,A
		JNB P3.5,_ELSIF2
		SETB _LED
		MOV _FREQ,#20d
		LJMP _FINALLY
	_ELSIF2:
		MOV A,#00000100b
		MOVX @DPTR,A
		JNB P3.5,_FINALLY
		SETB _LED
		MOV _FREQ,#40d
	_FINALLY:
		RET
END